/*!
 * VERSION: 0.1.0
 * DATE: 2015-09-24
 * GIT:https://github.com/shrekshrek/image-selecter
 *
 * @author: Shrek.wang, shrekshrek@gmail.com
 **/

!function(e){var t="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["exif","exports"],function(i,a){t.ImgSlter=e(t,a,i)});else if("undefined"!=typeof exports){var i=require("exif");e(t,exports,i)}else t.ImgSlter=e(t,{},t.EXIF)}(function(e,t,i){function a(){var e=navigator.userAgent;return{ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),iosv:e.substr(e.indexOf("iPhone OS")+9,3)}}function c(e,t){for(var i in t)e[i]=t[i]}return t=function(){this.initialize.apply(this,arguments)},c(t.prototype,{initialize:function(e){var t=this,i=e||{};this.el=i.el||function(){var e=document.createElement("INPUT");return e.type="file",e.accept="image/*",e.capture="camera",e}(),this.size=i.size||500,this.type=i.type||"jpeg",this.quality=i.quality||.7,this.handler=i.handler||function(){},this.ua=a(),this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this.changeHandler=function(e){t.change(e)},this.el.addEventListener("change",this.changeHandler,!1)},change:function(e){var t=this,a=e.target.files[0];if(void 0!=a){var c,n,s,r,h,l;window.URL=window.URL||window.webkitURL;var o=window.URL.createObjectURL(a),d=new Image;d.src=o,d.onload=function(){i.getData(d,function(){var e=i.getTag(this,"Orientation")||0;switch(c=d.width,r=d.height,c>=r?(n=t.size,h=n*r/c,s=c,l=r):(h=t.size,n=h*c/r,s=r,l=c),e){case 3:t.cvs.width=n,t.cvs.height=h,t.ctx.clearRect(0,0,n,h),t.ctx.translate(n/2,h/2),t.ctx.rotate(180*Math.PI/180);break;case 6:t.cvs.width=h,t.cvs.height=n,t.ctx.clearRect(0,0,h,n),t.ctx.translate(h/2,n/2),t.ctx.rotate(90*Math.PI/180);break;case 8:t.cvs.width=h,t.cvs.height=n,t.ctx.clearRect(0,0,h,n),t.ctx.translate(h/2,n/2),t.ctx.rotate(270*Math.PI/180);break;default:t.cvs.width=n,t.cvs.height=h,t.ctx.clearRect(0,0,n,h),t.ctx.translate(n/2,h/2)}s>3260||l>2440?t.ua.ios?parseInt(t.ua.iosv)>=8?t.ctx.drawImage(d,0,0,c,r,-n/2,-h/2,n,h):t.ctx.drawImage(d,0,0,c/2,r/2,-n/2,-h/2,n,h):t.ctx.drawImage(d,0,0,c,r,-n/2,-h/2,n,h):t.ctx.drawImage(d,-n/2,-h/2,n,h),t.handler.call(this,{img:t.cvs.toDataURL("image/"+t.type,t.quality),width:t.cvs.width,height:t.cvs.height}),window.URL.revokeObjectURL(a)})}}},select:function(){this.el&&this.el.click()},destroy:function(){this.el.removeEventListener("change",this.changeHandler,!1),delete this.ua,delete this.ctx,delete this.cvs,delete this.el}}),t});
